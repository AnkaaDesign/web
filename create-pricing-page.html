<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Test Pricing Data</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }

    h1 {
      color: #1a202c;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #718096;
      font-size: 14px;
      margin-bottom: 32px;
    }

    .info-box {
      background: #f7fafc;
      border-left: 4px solid #4299e1;
      padding: 16px;
      margin-bottom: 24px;
      border-radius: 4px;
    }

    .info-box h3 {
      color: #2d3748;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .info-box ul {
      list-style: none;
      font-size: 13px;
      color: #4a5568;
    }

    .info-box li {
      padding: 4px 0;
      display: flex;
      justify-content: space-between;
    }

    .info-box strong {
      color: #2d3748;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    button:active:not(:disabled) {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .result {
      margin-top: 24px;
      padding: 16px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }

    .result.success {
      background: #f0fdf4;
      border: 1px solid #86efac;
      color: #166534;
      display: block;
    }

    .result.error {
      background: #fef2f2;
      border: 1px solid #fca5a5;
      color: #991b1b;
      display: block;
    }

    .result.loading {
      background: #eff6ff;
      border: 1px solid #93c5fd;
      color: #1e40af;
      display: block;
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #93c5fd;
      border-top-color: #1e40af;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    pre {
      background: #1a202c;
      color: #e2e8f0;
      padding: 16px;
      border-radius: 8px;
      font-size: 12px;
      overflow-x: auto;
      margin-top: 12px;
    }

    .steps {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e2e8f0;
    }

    .steps h3 {
      color: #2d3748;
      font-size: 16px;
      margin-bottom: 12px;
    }

    .steps ol {
      margin-left: 20px;
      color: #4a5568;
      font-size: 14px;
      line-height: 1.8;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ Create Test Pricing Data</h1>
    <p class="subtitle">Task ID: 82d32ee1-6981-4240-996e-255d38faedcb</p>

    <div class="info-box">
      <h3>üìä Pricing Data to be Created:</h3>
      <ul>
        <li><span>Items:</span> <strong>5 services</strong></li>
        <li><span>Subtotal:</span> <strong>R$ 15.500,00</strong></li>
        <li><span>Discount:</span> <strong>10% (R$ 1.550,00)</strong></li>
        <li><span>Total:</span> <strong>R$ 13.950,00</strong></li>
        <li><span>Status:</span> <strong>APPROVED</strong></li>
        <li><span>Valid for:</span> <strong>30 days</strong></li>
      </ul>
    </div>

    <button id="createBtn" onclick="createPricing()">
      Create Pricing Data
    </button>

    <div id="result" class="result"></div>

    <div class="steps">
      <h3>üìù After Success:</h3>
      <ol>
        <li>Refresh the task edit page</li>
        <li>Scroll to "Precifica√ß√£o Detalhada" section</li>
        <li>Click "Exportar PDF" button</li>
        <li>Test the budget export feature!</li>
      </ol>
    </div>
  </div>

  <script>
    const API_URL = 'http://192.168.0.14:3030';
    const TASK_ID = '82d32ee1-6981-4240-996e-255d38faedcb';

    async function createPricing() {
      const btn = document.getElementById('createBtn');
      const resultDiv = document.getElementById('result');

      // Calculate expiry date (30 days from now)
      const expiryDate = new Date();
      expiryDate.setDate(expiryDate.getDate() + 30);
      expiryDate.setHours(23, 59, 59, 999);

      const pricingData = {
        taskId: TASK_ID,
        subtotal: 15500.00,
        discountType: 'PERCENTAGE',
        discountValue: 10.00,
        total: 13950.00,
        status: 'APPROVED',
        expiresAt: expiryDate.toISOString(),
        items: [
          {
            description: 'Adesiva√ß√£o Completa do Caminh√£o - Laterais e Traseira',
            amount: 8500.00
          },
          {
            description: 'Aplica√ß√£o de Logotipo em Vinil de Alta Qualidade',
            amount: 2500.00
          },
          {
            description: 'Envelopamento Completo de Para-choque Dianteiro',
            amount: 1800.00
          },
          {
            description: 'Recorte em Plotter e Plotagem de Arte',
            amount: 1200.00
          },
          {
            description: 'Aplica√ß√£o de Pel√≠cula de Prote√ß√£o UV',
            amount: 1500.00
          }
        ]
      };

      // Disable button and show loading
      btn.disabled = true;
      resultDiv.className = 'result loading';
      resultDiv.innerHTML = '<span class="spinner"></span>Creating pricing data...';

      try {
        const response = await fetch(`${API_URL}/task-pricings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include', // Important: includes cookies for authentication
          body: JSON.stringify(pricingData)
        });

        const data = await response.json();

        if (response.ok && data.success !== false) {
          resultDiv.className = 'result success';
          resultDiv.innerHTML = `
            <strong>‚úÖ Success!</strong> Test pricing data created successfully!
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
          console.log('‚úÖ Pricing created:', data);
        } else {
          throw new Error(data.message || data.error || 'Failed to create pricing');
        }
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `
          <strong>‚ùå Error:</strong> ${error.message}
          <br><br>
          <strong>Possible issues:</strong>
          <ul style="margin-left: 20px; margin-top: 8px;">
            <li>Not logged in (authentication required)</li>
            <li>Task already has pricing data</li>
            <li>API server is not running</li>
            <li>Task ID does not exist</li>
          </ul>
          <br>
          <strong>üí° Tip:</strong> Make sure you're logged into the application in another tab first, then try again.
        `;
        console.error('‚ùå Error:', error);
      } finally {
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
